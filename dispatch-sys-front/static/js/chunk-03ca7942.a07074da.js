(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03ca7942"],{"21a5":function(t,a,e){"use strict";var i=e("24f2"),n=e.n(i);n.a},"24f2":function(t,a,e){},5919:function(t,a,e){"use strict";e.d(a,"c",(function(){return n})),e.d(a,"a",(function(){return o})),e.d(a,"d",(function(){return s})),e.d(a,"b",(function(){return l}));var i=e("b775");function n(){return Object(i["a"])({url:"/domain/getDomainList",method:"get"})}function o(t,a,e){return Object(i["a"])({url:"/domain/createDomain",method:"post",data:{name:t,domainType:a,detailAdress:e}})}function s(t,a,e,n){return Object(i["a"])({url:"/domain/updateDomain",method:"post",data:{id:t,name:a,domainType:e,detailAdress:n}})}function l(t){return Object(i["a"])({url:"/domain/deleteDomain",method:"get",params:{domainId:t}})}},8179:function(t,a,e){},"84e0":function(t,a,e){"use strict";var i=e("8179"),n=e.n(i);n.a},d032:function(t,a,e){"use strict";function i(t){return JSON.parse(JSON.stringify(t))}e.d(a,"a",(function(){return i}))},ea5c:function(t,a,e){"use strict";e.r(a);var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"app-container"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:16}},[e("div",{staticClass:"map-bar"},[e("h4",{staticStyle:{display:"inline"}},[t._v(t._s(t.computedMap.mapInfo.usermapname))])]),t._v(" "),e("div",{staticClass:"content-box",staticStyle:{width:"100%",height:"500px"}},[t.loading?t._e():e("el-image",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.computedMap.mapInfo.backimgUrl,lazy:"",fit:"contain"}})],1)]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"map-bar"},[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:8}},[e("span",{staticStyle:{"min-width":"80px",background:"#00A0E9",color:"#FFF",height:"100%",display:"inline-block","margin-left":"-20px",padding:"0 0 0 15px"}},[t._v("工位点")])]),t._v(" "),e("el-col",{attrs:{span:16}},[e("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入工位点ID/工位名","suffix-icon":"el-icon-search"},model:{value:t.filterStr,callback:function(a){t.filterStr=a},expression:"filterStr"}})],1)],1)],1),t._v(" "),e("div",{staticClass:"content-box",staticStyle:{width:"100%",height:"500px"}},[e("div",{directives:[{name:"bar",rawName:"v-bar",value:{preventParentScroll:!1},expression:"{ preventParentScroll: false}"}],staticStyle:{height:"100%",padding:"10px 0"}},[e("div",[e("ul",{staticStyle:{padding:"0"}},t._l(t.spots,(function(a){return 0!==a.type?e("li",{staticClass:"spot-list"},[e("span",[e("v-icon",{style:{color:t.colors[a.type]},attrs:{name:"bars"}}),t._v("\n                     \n                  "+t._s(a.code)+"\n                ")],1),t._v("\n                     \n                  "),e("span",[t._v(t._s(a.alias?a.alias:"- - -"))])]):t._e()})),0)])])])])],1),t._v(" "),e("div",{staticClass:"content-box",staticStyle:{padding:"50px 200px",margin:"10px auto"}},[e("el-steps",{staticStyle:{transform:"scale(1.3)"},attrs:{active:t.step,"align-center":""}},[e("el-step",{attrs:{title:"上传地图"}},[e("v-icon",{attrs:{slot:"icon",name:"arrow-alt-circle-up"},slot:"icon"})],1),t._v(" "),e("el-step",{attrs:{title:"区域绑定"}},[e("v-icon",{attrs:{slot:"icon",name:"link"},slot:"icon"})],1),t._v(" "),e("el-step",{attrs:{title:"地图启用"}},[e("v-icon",{attrs:{slot:"icon",name:"play-circle"},slot:"icon"})],1),t._v(" "),e("el-step",{attrs:{title:"完成"}},[e("v-icon",{attrs:{slot:"icon",name:"check-circle"},slot:"icon"})],1)],1)],1),t._v(" "),e("div",{staticClass:"content-box",staticStyle:{padding:"10px 0"}},[e("div",{staticStyle:{height:"50px","line-height":"50px","border-bottom":"1px solid #ddd",padding:"0 20px","font-weight":"500"}},[e("i",{staticClass:"el-icon-monitor",staticStyle:{"font-weight":"bold","margin-right":"5px"}}),t._v("\n      当前状态："+t._s(t.computedMap.mapDomain?"已绑定":"未绑定")+"\n      "),e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],staticStyle:{float:"right","margin-left":"20px",position:"relative",top:"7px"},attrs:{disabled:!t.computedMap.mapDomain,type:"danger",size:"medium",plain:""},on:{click:t.deleteBind}},[t._v("删除绑定")])],1),t._v(" "),e("div",{staticClass:"item-box"},[e("p",[t._v("已绑定区域")]),t._v(" "),e("el-row",{staticStyle:{padding:"0 85px","font-size":"14px"},attrs:{gutter:10}},[e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("区域ID："+t._s(t.computedMap.mapDomain?t.computedMap.mapDomain.domainId:" - - -"))]),t._v(" "),e("p",{staticClass:"item"},[t._v("区域创建时间："+t._s(t.dateFormatStamp(t.computedMap.mapDomain?t.computedMap.mapDomain.time:"")))])]),t._v(" "),e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("已绑定区域："+t._s(t.computedMap.domianInfo?t.computedMap.domianInfo.name:"- -  "))]),t._v(" "),e("p",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],staticClass:"item"},[t._v("\n            操作：\n            "),e("el-tooltip",{attrs:{content:"需要先删除绑定，然后重新绑定",placement:"top"}},[e("el-button",{attrs:{type:"text"},on:{click:function(a){return t.editBind(!0)}}},[t._v("修改绑定\n                "),e("i",{staticClass:"el-icon-edit el-icon--right"})])],1)],1)]),t._v(" "),e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("操作人员："+t._s(t.computedMap.userInfo?t.computedMap.userInfo.username:"- - -"))])])],1)],1),t._v(" "),e("div",{staticClass:"item-box"},[e("p",[t._v("地图属性")]),t._v(" "),e("el-row",{staticStyle:{padding:"0 85px","font-size":"14px"},attrs:{gutter:10}},[e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("地图ID："+t._s(t.computedMap.mapInfo.id))]),t._v(" "),e("p",{staticClass:"item"},[t._v("版本："+t._s(t.computedMap.mapInfo.version))]),t._v(" "),e("p",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["map/update","map/delete"],expression:"['map/update','map/delete']"}],staticClass:"item"},[t._v("操作：\n            "),e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],attrs:{type:"text"},on:{click:function(a){t.uploadDialogVisible=!0}}},[t._v("更新"),e("i",{staticClass:"el-icon-refresh el-icon--right"})]),t._v(" "),e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],attrs:{type:"text"},on:{click:t.rename}},[t._v("重命名"),e("i",{staticClass:"el-icon-edit el-icon--right"})]),t._v(" "),e("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/delete",expression:"'map/delete'"}],staticStyle:{color:"#F56C6C"},attrs:{type:"text"},on:{click:t.delMap}},[t._v("删除"),e("i",{staticClass:"el-icon-delete el-icon--right"})])],1)]),t._v(" "),e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("地图名称："+t._s(t.computedMap.mapInfo.usermapname))]),t._v(" "),e("p",{staticClass:"item"},[t._v("\n            是否启用：\n            "),e("span",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}]},[e("toggle-button",{attrs:{value:0!==t.computedMap.mapInfo.enabled,color:"#82C7EB",width:50,height:20,sync:!0,labels:!0},on:{change:function(a){return t.switchEnableMap(a,t.computedMap.mapInfo)}}})],1),t._v(" "),e("span",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"!map/update",expression:"'!map/update'"}]},[t._v(t._s(t.computedMap.mapInfo.enabled?"已启用":"未启用"))])])]),t._v(" "),e("el-col",{attrs:{xs:8,sm:8,md:8,lg:8,xl:8}},[e("p",{staticClass:"item"},[t._v("大小："+t._s(t.computedMap.mapInfo.mapSize))]),t._v(" "),e("p",{staticClass:"item"},[t._v("上次更新："+t._s(t.dateFormatStamp(t.computedMap.mapInfo.lastUpdatetime)))])])],1)],1)]),t._v(" "),e("el-dialog",{attrs:{title:"地图绑定",width:"320px",visible:t.bindDialogVisible,center:""},on:{"update:visible":function(a){t.bindDialogVisible=a}}},[e("el-form",[e("el-form-item",{attrs:{label:"选择区域","label-width":"70px"}},[e("el-select",{attrs:{placeholder:"请选择区域"},model:{value:t.bindDomainId,callback:function(a){t.bindDomainId=a},expression:"bindDomainId"}},[e("el-option",{key:"0",attrs:{label:"未选择",value:0}}),t._v(" "),t._l(t.domainListData,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1)],1),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.bindDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(a){return t.editBind(!1)}}},[t._v("确 定")])],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"更新地图",visible:t.uploadDialogVisible,width:"410px",center:""},on:{"update:visible":function(a){t.uploadDialogVisible=a}}},[e("el-alert",{staticClass:"alertWarning",attrs:{title:"更新操作可能会影响该区域下已下发的任务执行",type:"warning","show-icon":"",closable:!1}}),t._v(" "),e("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"on-remove":t.removeFile,"on-change":t.fileListChange,"on-success":t.uploadSuccess,"on-error":t.uploadErr,"on-exceed":t.exceedLimit,"auto-upload":!1,drag:"",limit:1,action:"/api/mapManagement/updateMap",name:"map",data:{mapId:t.computedMap.mapInfo.id}}},[e("i",{staticClass:"el-icon-upload"}),t._v(" "),e("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),e("em",[t._v("点击上传")])]),t._v(" "),e("div",{staticClass:"el-upload__tip",staticStyle:{color:"#F20"},attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.uploadMessage))])]),t._v(" "),e("div",{staticStyle:{margin:"10px auto","font-size":"12px",color:"#f00"}},[t._v("\n      "+t._s(t.showErr)+"\n    ")]),t._v(" "),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.uploadDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.submitUpload}},[t._v("确 定")])],1)],1)],1)},n=[],o=(e("7f7f"),e("ac6a"),e("7661")),s=e("b199"),l=e("5919"),p=e("fb92"),c=(e("d032"),e("d06d"),e("f206")),r=e("0874"),m={components:{"v-icon":r["a"],ToggleButton:c["ToggleButton"]},data:function(){return{colors:["#CCCCCC","#FF8400","#898989","#00A0E9","#FF0000"],bindDialogVisible:!1,domainListData:[],bindDomainId:0,loading:!0,filterStr:"",map:{},step:1,uploadDialogVisible:!1,uploadMessage:"",showErr:""}},watch:{computedMap:{handler:function(){},deep:!0}},computed:{computedMap:function(){return{domianInfo:this.map.domianInfo?this.map.domianInfo:"",mapDomain:this.map.mapDomain?this.map.mapDomain:"",mapInfo:this.map.mapInfo?this.map.mapInfo:"",userInfo:this.map.userInfo?this.map.userInfo:""}},spots:function(){var t=this,a=this.computedMap.mapInfo.spots?this.computedMap.mapInfo.spots:[];return this.filterStr?a.filter((function(a){var e=t.filterStr.toLowerCase();return(a.id+"").indexOf(e)>-1||a.alias.toLowerCase().indexOf(e)>-1||a.code.toLowerCase().indexOf(e)>-1})):a}},created:function(){this.getMapDetailById()},methods:{getMapDetailById:function(){var t=this;Object(o["c"])(this.$route.params.id).then((function(a){t.map=a,t.bindDomainId=t.map.mapDomain?t.map.mapDomain.domainId:"",t.map.mapDomain?t.step=2:t.step=1,t.map.mapDomain&&1===t.map.mapInfo.enabled&&(t.step=4),Object(s["n"])().then((function(a){t.$store.commit("DOMAIN_TYPE_LIST",a);var e=[];a.forEach((function(t,a){var i={value:t.id,label:t.name,children:[]};0!==t.mapNames.length&&(t.mapNames.forEach((function(a,e){var n={value:t.mapIds[e],label:a};i.children.push(n)})),e.push(i))})),t.$store.commit("DOMAIN_MAP_LIST",e)})),t.loading=!1}))},switchEnableMap:function(t,a){var e=this,i=t.value;Object(o["b"])(a.id,i?1:0).then((function(t){t.status||(e.computedMap.mapInfo.enabled=!e.computedMap.mapInfo.enabled),e.getMapDetailById()})).catch((function(t){e.loading=!0,e.map={},setTimeout((function(){e.getMapDetailById()}),500)}))},removeFile:function(){this.uploadMessage=""},uploadSuccess:function(t,a,e){var i=this;if(this.uploadMessage=t.message,t.status){this.getMapDetailById();setTimeout((function(){i.uploadDialogVisible=!1,i.uploadMessage="",i.showErr="",i.$refs.upload.clearFiles()}),1e3)}},uploadErr:function(t,a,e){console.error("uploadFileErr",t),this.uploadMessage="error! 请查看控制台错误信息"},exceedLimit:function(){this.uploadMessage="当前只允许上传一个文件，超出限制"},fileListChange:function(){this.showErr=""},submitUpload:function(){this.$refs.upload.uploadFiles.length<1?this.showErr="请选择文件":this.$refs.upload.submit()},dateFormatStamp:function(t){return Object(p["a"])(t)},delMap:function(){var t=this;this.$confirm("此操作将删除 ".concat(this.map.mapInfo.usermapname," 地图, 是否继续?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["a"])(t.map.mapInfo.id).then((function(a){t.$router.push({path:"/map/maplist"})}))})).catch((function(){}))},editBind:function(t){var a=this;t?(this.bindDomainId=this.map.mapDomain?this.map.mapDomain.domainId:"",Object(l["c"])().then((function(t){a.bindDialogVisible=!0,a.domainListData=t}))):this.bindDomainId&&Object(o["i"])(this.map.mapInfo.id,this.bindDomainId).then((function(t){a.bindDialogVisible=!1,a.getMapDetailById();var e=setTimeout((function(){clearTimeout(e)}),500)}))},deleteBind:function(){var t=this;this.$confirm("此操作将删除当前绑定状态, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["k"])(t.map.mapInfo.id,t.bindDomainId).then((function(a){t.switchEnableMap({value:0},t.computedMap.mapInfo),t.getMapDetailById()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},rename:function(){var t=this;this.$prompt("请输入新的名称","地图重命名",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(a){var e=a.value;Object(o["l"])(t.map.mapInfo.id,e).then((function(a){t.getMapDetailById()}))})).catch((function(){}))}}},d=m,u=(e("21a5"),e("84e0"),e("2877")),f=Object(u["a"])(d,i,n,!1,null,"3af5c7d6",null);a["default"]=f.exports},fb92:function(t,a,e){"use strict";e.d(a,"a",(function(){return n}));e("6b54");function i(t){return t=t.toString(),t[1]?t:"0"+t}function n(t){if(!t)return"- - -";var a=new Date(t),e=a.getFullYear(),n=i(a.getMonth()+1),o=i(a.getDate()),s=i(a.getHours()),l=i(a.getMinutes()),p=i(a.getSeconds());return e+"-"+n+"-"+o+" "+s+":"+l+":"+p}}}]);