(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e26b974"],{2840:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return r}));var n=a("b775");function i(e){return n["a"].post("/area/list",e)}function o(e){return n["a"].post("/area/update",e)}function r(e){return n["a"].post("/area/delete/"+e)}},"375c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mapDetails-container"},[a("div",{staticClass:"content-box step-main"},[a("el-steps",{staticStyle:{transform:"scale(1.3)"},attrs:{active:e.step,"align-center":""}},[a("el-step",{attrs:{title:"上传地图"}},[a("v-icon",{attrs:{slot:"icon",name:"arrow-alt-circle-up"},slot:"icon"})],1),e._v(" "),a("el-step",{attrs:{title:"地图启用"}},[a("v-icon",{attrs:{slot:"icon",name:"play-circle"},slot:"icon"})],1),e._v(" "),a("el-step",{attrs:{title:"完成"}},[a("v-icon",{attrs:{slot:"icon",name:"check-circle"},slot:"icon"})],1)],1),e._v(" "),a("div",{staticClass:"step-title"},[e.backPage?a("el-page-header",{attrs:{content:e.topologyMap.alias||e.topologyMap.name},on:{back:e.goBack}}):a("span",[e._v(e._s(e.topologyMap.alias||e.topologyMap.name))])],1)],1),e._v(" "),a("div",{staticClass:"spot-map-main"},[a("div",{staticClass:"content-box spot-main"},[a("div",{staticClass:"spot-filter"},[a("el-input",{attrs:{placeholder:"ID/编号/别名",clearable:""},model:{value:e.spotFilter,callback:function(t){e.spotFilter="string"===typeof t?t.trim():t},expression:"spotFilter"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[e._v("工位点")])])],1),e._v(" "),a("el-table",{attrs:{data:e.spots,height:e.innerHeight-288,"header-cell-style":{background:"#eee"},"highlight-current-row":"",stripe:""}},[a("el-table-column",{attrs:{align:"center",label:"ID",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.vertexPo.id)+"\n          ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.vertexPo.code)+"\n          ")]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",label:"别名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.row.vertexPo.alias||"---")+"\n          ")]}}])})],1)],1),e._v(" "),a("div",{staticClass:"content-box map-main",style:{height:e.innerHeight-228+"px"}},[a("div",{staticClass:"header"},[a("span",{staticClass:"title"},[e._v(e._s(e.topologyMap.alias||e.topologyMap.name))]),e._v(" "),a("span",{staticClass:"buttons"},[a("el-switch",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],staticClass:"switch",attrs:{"active-value":1,"inactive-value":0},on:{change:function(t){return e.toggleEnable()}},model:{value:e.topologyMap.enable,callback:function(t){e.$set(e.topologyMap,"enable","string"===typeof t?t.trim():t)},expression:"topologyMap.enable"}}),e._v(" "),a("a",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/download",expression:"'map/download'"}],style:{marginRight:"10px"},attrs:{href:e.topologyMap.mapFileUrl&&("development"===e.nodeEnv?"/api/":"/")+e.topologyMap.mapFileUrl.replace(/\\/g,"/")}},[a("el-button",{attrs:{size:"mini",type:"primary",plain:""}},[e._v("下载")])],1),e._v(" "),a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/update",expression:"'map/update'"}],attrs:{size:"mini",type:"warning",plain:""},on:{click:function(t){return e.openEditDialog()}}},[e._v("修改")]),e._v(" "),a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"map/delete",expression:"'map/delete'"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(t){return e.deleteMap()}}},[e._v("删除")])],1)]),e._v(" "),a("div",{staticClass:"detail"},[a("div",[e._v("地图ID: "+e._s(e.topologyMap.id))]),e._v(" "),a("div",[e._v("\n          大小:\n          "+e._s(e.topologyMap.fileSize&&Math.floor(1e3*e.topologyMap.fileSize)+"KB")+"\n        ")]),e._v(" "),a("div",[e._v("更新时间: "+e._s(e._f("dateTime")(e.topologyMap.updateTime)))]),e._v(" "),a("div",[e._v("区域名称: "+e._s(e.area.name))])]),e._v(" "),a("div",{ref:"imageParent",staticClass:"image"},[a("img",{attrs:{src:e.pngSrc,id:"imageChild"}})])])]),e._v(" "),a("el-dialog",{attrs:{title:"编辑地图",visible:e.isDialog,width:"410px",center:""},on:{"update:visible":function(t){e.isDialog=t},close:e.closeDialog}},[a("el-form",{ref:"mapForm",attrs:{"label-width":"85px",model:e.mapForm,rules:e.mapRules}},[a("el-form-item",{attrs:{label:"地图别名: "}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入地图别名"},model:{value:e.mapForm.alias,callback:function(t){e.$set(e.mapForm,"alias","string"===typeof t?t.trim():t)},expression:"mapForm.alias"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工作区域: ",prop:"areaId"}},[a("el-select",{attrs:{placeholder:"请选择区域",clearable:"",filterable:""},model:{value:e.mapForm.areaId,callback:function(t){e.$set(e.mapForm,"areaId","string"===typeof t?t.trim():t)},expression:"mapForm.areaId"}},e._l(e.domainList,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:Number(t)}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"楼层: ",prop:"floor"}},[a("el-input-number",{attrs:{precision:0,step:1,"controls-position":"right"},model:{value:e.mapForm.floor,callback:function(t){e.$set(e.mapForm,"floor",e._n(t))},expression:"mapForm.floor"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"转弯角度: ",prop:"determineTurningAngle"}},[a("el-input-number",{attrs:{precision:2,step:1,"controls-position":"right"},model:{value:e.mapForm.determineTurningAngle,callback:function(t){e.$set(e.mapForm,"determineTurningAngle",e._n(t))},expression:"mapForm.determineTurningAngle"}})],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveEdit}},[e._v("确 定")])],1)],1)],1)},i=[],o=(a("8dee"),a("a450"),a("1bc7"),a("7661")),r=a("2840"),s=a("a68a"),l={name:"mapDetails",props:["innerHeight"],data:function(){return{loading:!0,spotFilter:"",Edge:[],Vertex:[],area:{},topologyMap:{},step:1,pngSrc:"",mapForm:{alias:"",reaId:"",floor:"",determineTurningAngle:""},isDialog:!1,mapRules:{areaName:[{required:!0,trigger:"change",message:"请选择工作区域"}],areaId:[{required:!0,trigger:"change",message:"请选择工作区域"}],floor:[{message:"楼层应为数字",pattern:/^[-.\d]+$/,trigger:"blur"}],determineTurningAngle:[{message:"转弯角度应为数字",pattern:/^[-.\d]+$/,trigger:"blur"}]},domainList:{},backPage:"",nodeEnv:"production"}},computed:{spots:function(){var e=this;return this.Vertex.filter((function(t){var a=t.vertexPo,n=e.spotFilter.toLowerCase();return(String(a.id).indexOf(n)>-1||a.alias.toLowerCase().indexOf(n)>-1||a.code.toLowerCase().indexOf(n)>-1)&&0!==a.type}))}},mounted:function(){var e=this;this.getMapDetailById(),this.onResize(),Object(r["c"])().then((function(t){t.state&&t.data.data&&t.data.data.forEach((function(t){e.$set(e.domainList,t.id,t.name)}))})),this.backPage=this.$route.query.backPage},methods:{onResize:function(){var e=this;this.$nextTick((function(){document.getElementById("imageChild").style.maxWidth=e.$refs.imageParent.offsetWidth-80+"px",document.getElementById("imageChild").style.maxHeight=e.$refs.imageParent.offsetHeight-50+"px"}))},getMapDetailById:function(){var e=this;this.loading=!0,Object(o["b"])({mapId:this.$route.params.id}).then((function(t){if(e.loading=!1,t.state){var a=t.data,n=a.Edge,i=a.Vertex,o=a.area,r=a.topologyMap;e.Edge=n,e.Vertex=i,e.area=o,e.topologyMap=r,e.step=r.enable?3:1,e.pngSrc=""+r.backgroundImgUrl.replace(/\\/g,"/")}}))},toggleEnable:function(){var e=this,t=1===this.topologyMap.enable?"启用":"禁用",a=function(){e.topologyMap.enable=1===e.topologyMap.enable?0:1};this.$confirm("确定".concat(t).concat(this.topologyMap.alias||this.topologyMap.name,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["d"])(e.topologyMap).then((function(n){n.state?(e.$message.success("地图".concat(t,"成功")),e.getMapDetailById()):a()}))})).catch((function(){a()}))},openEditDialog:function(){this.mapForm=JSON.parse(JSON.stringify(this.topologyMap)),this.isDialog=!0},closeDialog:function(){this.$refs.mapForm.clearValidate(),this.isDialog=!1},saveEdit:function(){var e=this;this.$refs.mapForm.validate((function(t){t&&Object(o["d"])(e.mapForm).then((function(t){t.state&&(s["Message"].success("地图修改成功"),e.isDialog=!1,e.getMapDetailById())}))}))},deleteMap:function(){var e=this;if(this.topologyMap.enable)return s["Message"].warning("请先禁用该地图");s["MessageBox"].confirm("确定删除地图: ".concat(this.topologyMap.alias||this.topologyMap.name,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["a"])(e.topologyMap.id).then((function(t){t.state&&(s["Message"].success("地图删除成功"),e.$router.push("/map/index"))}))})).catch((function(){}))},goBack:function(){this.$router.push(this.backPage)}}},p=l,c=(a("e05e"),a("4ac2")),u=Object(c["a"])(p,n,i,!1,null,"1c5a27aa",null);t["default"]=u.exports},7661:function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return s}));var n=a("b775");function i(e){return n["a"].get("/map/mapList",e)}function o(e){return n["a"].post("/map/updateMap",e)}function r(e){return n["a"].post("/map/delete/"+e)}function s(e){return n["a"].get("/map/getMapDetailById",e)}},e05e:function(e,t,a){"use strict";a("e43f")},e43f:function(e,t,a){}}]);