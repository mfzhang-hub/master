(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-33568ea9"],{"00db":function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return c}));var a=n("b775");function i(){return a["a"].get("/equipment/type")}function r(e){return a["a"].post("/equipment/list",e)}function s(e){return a["a"].post("/equipment/add",e)}function o(e){return a["a"].post("equipment/update",e)}function c(e){return a["a"].get("/equipment/delete?id="+e)}},"0115":function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"f",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"e",(function(){return f}));var a=n("b775");function i(){return a["a"].get("/chargePile/model/findAll")}function r(e){return a["a"].post("/chargePile/page",e)}function s(e){return a["a"].post("/chargePile/add",e)}function o(e){var t=e.id,n=e.enable;return a["a"].get("/chargePile/enable?id="+t+"&state="+n)}function c(e){var t=e.id,n=e.modelId;return a["a"].get("chargePile/bindModel?id="+t+"&modelId="+n)}function l(e){return a["a"].get("/chargePile/delete?id="+e)}function u(e){return a["a"].get("/map/getMapVertexes/"+e)}function f(e){return a["a"].post("chargePile/history/detail",e)}},"1b70":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("5a05"),n("89a8"),n("a536");var a=function(e){var t=e.filter((function(t){return t[0]===e[0][0]}));if(t.length===e.length)return e=e.sort((function(e,t){return e[1]-t[1]})),[e[0],e[e.length-1]];var n=e.filter((function(t){return t[1]===e[0][1]}));if(n.length===e.length)return e=e.sort((function(e,t){return e[0]-t[0]})),[e[0],e[e.length-1]];e=e.sort((function(e,t){return e[0]-t[0]||e[1]-t[1]}));var a=[],s=e.length;if(s<3)return e;var o,c,l=0,u=2,f=new Object;for(o=1;o<s;o++)(e[o][1]<e[l][1]||e[o][1]==e[l][1]&&e[o][0]<e[l][0])&&(l=o);f=e[0],e[0]=e[l],e[l]=f;var d=s;for(o=1;o<d-1;o++){for(l=o,c=o+1;c<d;c++){var m=i(e[0],e[l],e[c]);if(m>0)l=c;else if(0==m){var p=r(e[0],e[c])-r(e[0],e[l]);d--,p>0?(e[l]=e[c],e[c]=e[d],c--):(f=e[d],e[d]=e[c],e[c]=f)}}f=e[o],e[o]=e[l],e[l]=f}for(a.push(e[0]),a.push(e[1]),a.push(e[2]),o=3;o<d;o++){while(e[o]&&a[u-1]&&a[u]&&!(i(e[o],a[u-1],a[u])<0))u--,a.pop();u++,a.push(e[o])}return a.push(e[0]),a},i=function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])},r=function(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}},"21ac":function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("a018"),i=n("e902"),r=(n("89a8"),n("1a91"),n("1926"),n("2788"),n("10dd"),n("5422")),s=n("0f8a"),o=function(){function e(){Object(a["a"])(this,e),this.dangerNotificationList={}}return Object(i["a"])(e,[{key:"getDangerList",value:function(e){var t={};e.forEach((function(e){var n=e["amrException"]["exception"].join("-");if([7,8,9].includes(e["warnId"])){9===e["stateId"]&&(n="等待用户确认");var a=e["name"]+" ("+e["id"]+")";t[a]=n||s["d"][e["stateId"]]}})),this.dangerNotification(t)}},{key:"dangerNotification",value:function(e){var t=this;for(var n in this.dangerNotificationList){var a=this.dangerNotificationList[n],i=e[n];a.value!==i&&(a.notification&&a.notification.close(),delete this.dangerNotificationList[n])}var s=function(n){var a=e[n],i=t.dangerNotificationList[n];i&&i.value===a||setTimeout((function(){var e=Object(r["Notification"])({title:n,message:a,duration:0,position:"bottom-right",customClass:"danger-notification"});t.dangerNotificationList[n]={notification:e,value:a}}),0)};for(var o in e)s(o)}}]),e}()},"22a1":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLog,expression:"!isLog"}],staticClass:"ui-layer agv-layer",on:{mouseenter:e.mouseoverAgvLayer,mouseleave:e.mouseLeaveAgvLayer}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.tableVisible,expression:"tableVisible"}]},[n("div",{staticStyle:{color:"#999","text-indent":"20px",cursor:"pointer"},on:{click:function(t){e.tableVisible=!1}}},[e._v(" 设备状态 ")]),n("table",{staticClass:"agv-layer-table"},[e._m(0),n("tbody",e._l(e.amrList,(function(t,a){return n("tr",{directives:[{name:"show",rawName:"v-show",value:!e.stateFilter||88!==e.stateFilter&&e.stateFilter===t["stateId"]||88===e.stateFilter&&t["isParkingBarrier"],expression:"\n            !stateFilter ||\n            (stateFilter !== 88 && stateFilter === amr['stateId']) ||\n            (stateFilter === 88 && amr['isParkingBarrier'])\n          "}],key:a,class:{"danger-row":[7,8].includes(t.warnId),"warning-row":[4,9,6].includes(t.warnId),"offline-row":[10].includes(t.warnId)},on:{click:function(n){return e.changeActiveInfoId(t["id"])}}},[n("td",[n("el-tooltip",{attrs:{content:t["name"],placement:"top"}},[n("div",[e._v(e._s(t["name"]))])])],1),n("td",[e._v(e._s(t["state"]))]),n("td",[e._v(e._s(t["batteryPercentile"])+"%")]),n("td",[n("el-tooltip",{attrs:{content:t["amrException"]["exception"].join("-"),placement:"top"}},[n("div",[e._v(" "+e._s(t["amrException"]["exception"].join("-"))+" ")])])],1),n("td",[n("el-link",{staticClass:"router-link",attrs:{type:"info"},on:{click:function(n){return n.stopPropagation(),e.$router.push({path:"/deviceDetails/"+t.id,query:{backPage:e.$route.fullPath}})}}},[e._v(" 详情 ")])],1)])})),0)]),n("div",{staticClass:"border-top"}),n("div",{staticClass:"border-bottom"})]),n("div",{ref:"agvList",staticClass:"agv-list"},[n("router-link",{staticClass:"router-link",attrs:{to:{path:"/device/amr",query:{backPage:e.$route.fullPath}}}},[n("div",[e._v("   总数 "),n("h2",{staticStyle:{display:"inline-block"}},[e._v(e._s(e.amrList.length))])])]),n("p",{class:{border:0===e.stateFilter},on:{click:function(t){e.stateFilter=0}}},[n("span",{staticClass:"status-icon status_2"},[e._v(e._s(e.amrList.length))]),n("span",{staticStyle:{color:"#67c23a"}},[e._v("全部")])]),n("p",{class:{border:2===e.stateFilter},on:{click:function(t){e.stateFilter=2===e.stateFilter?0:2}}},[n("span",{staticClass:"status-icon status_2"},[e._v(e._s(e.amrList.filter((function(e){return 2===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#fff"}},[e._v("作业")])]),n("p",{class:{border:3===e.stateFilter},on:{click:function(t){e.stateFilter=3===e.stateFilter?0:3}}},[n("span",{staticClass:"status-icon status_3"},[e._v(e._s(e.amrList.filter((function(e){return 3===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#fff"}},[e._v("充电")])]),n("p",{class:{border:4===e.stateFilter},on:{click:function(t){e.stateFilter=4===e.stateFilter?0:4}}},[n("span",{staticClass:"status-icon status_4"},[e._v(e._s(e.amrList.filter((function(e){return 4===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#fff"}},[e._v("等待")])]),n("p",{class:{border:9===e.stateFilter},on:{click:function(t){e.stateFilter=9===e.stateFilter?0:9}}},[n("span",{staticClass:"status-icon status_4"},[e._v(e._s(e.amrList.filter((function(e){return 9===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#fff"}},[e._v("确认")])]),n("p",{class:{border:6===e.stateFilter},on:{click:function(t){e.stateFilter=6===e.stateFilter?0:6}}},[n("span",{staticClass:"status-icon status_4"},[e._v(e._s(e.amrList.filter((function(e){return 6===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#fff"}},[e._v("暂停")])]),n("p",{class:{border:1===e.stateFilter},on:{click:function(t){e.stateFilter=1===e.stateFilter?0:1}}},[n("span",{staticClass:"status-icon status_1"},[e._v(e._s(e.amrList.filter((function(e){return 1===e["stateId"]})).length))]),n("span",{staticStyle:{color:"#888"}},[e._v("空闲")])]),n("p",{class:{border:88===e.stateFilter},on:{click:function(t){e.stateFilter=88===e.stateFilter?0:88}}},[n("span",{staticClass:"status-icon status_5"},[e._v(e._s(e.amrList.filter((function(e){return e["isParkingBarrier"]})).length))]),n("span",{staticStyle:{color:"#fff",background:"radial-gradient(#902851, rgba(144, 40, 81, 0.5))"}},[e._v("停障")])]),n("p",{class:{border:8===e.stateFilter},on:{click:function(t){e.stateFilter=8===e.stateFilter?0:8}}},[n("span",{staticClass:"status-icon status_5"},[e._v(e._s(e.amrList.filter((function(e){return 8===e["warnId"]})).length))]),n("span",{staticStyle:{color:"#fff",background:"radial-gradient(#902851, rgba(144, 40, 81, 0.5))"}},[e._v("异常")])])],1),n("i",{staticClass:"table-btn",class:{"el-icon-d-arrow-left":!e.tableVisible,"el-icon-d-arrow-right":e.tableVisible},on:{click:function(t){e.tableVisible=!e.tableVisible}}})])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("thead",[n("tr",{staticStyle:{background:"-webkit-linear-gradient("}},[n("th",[e._v("机器人")]),n("th",[e._v("状态")]),n("th",[e._v("电量")]),n("th",[e._v("告警")]),n("th",[e._v("详情")])])])}],r={props:["isLog","amrList","isPc"],data:function(){return{tableVisible:!1,stateFilter:0,isSortAmr:!0}},mounted:function(){var e=this;this.$refs.agvList.onmouseover=function(){e.tableVisible=!0}},watch:{tableVisible:function(){this.isPc||(this.isSortAmr=!this.tableVisible)}},beforeDestroy:function(){this.$refs.agvList.onmouseover=null},methods:{changeActiveInfoId:function(e){this.$emit("changeActiveInfoId",e)},mouseoverAgvLayer:function(){this.isPc&&(this.isSortAmr=!1)},mouseLeaveAgvLayer:function(){this.isPc&&(this.isSortAmr=!0)}}},s=r,o=n("cba8"),c=Object(o["a"])(s,a,i,!1,null,"514aed6e",null);t["default"]=c.exports},"25fe":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var a=n("b775");function i(e){return a["a"].post("/traffic/block/update",e)}function r(e){return a["a"].get("/traffic/block/find",e)}},"561f":function(e,t,n){"use strict";n("897d")},5771:function(e,t,n){},7661:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return o}));var a=n("b775");function i(e){return a["a"].get("/map/mapList",e)}function r(e){return a["a"].post("/map/updateMap",e)}function s(e){return a["a"].post("/map/delete/"+e)}function o(e){return a["a"].get("/map/getMapDetailById",e)}},"7cf8":function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"f",(function(){return u})),n.d(t,"c",(function(){return f}));var a=n("b775");function i(e){return a["a"].get("/amr/onlineAmr",e)}function r(e){return a["a"].get("/amr/getOnlineAmrById",e)}function s(){return a["a"].post("/area/monitor")}function o(e){return a["a"].get("/amr/getAmrTaskById",e)}function c(e){return a["a"].post("/amr/taskCommand/pause/"+e.id)}function l(e){return a["a"].post("/amr/taskCommand/resume/"+e.id)}function u(e){return a["a"].get("map/loadMapFileByAmr",e,"blob")}function f(){return a["a"].get("dispatch/vehicle/getActiveVehicles")}},"897d":function(e,t,n){},"897e":function(e,t,n){"use strict";n("ad1c")},ad1c:function(e,t,n){},bd3e:function(e,t,n){
/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/
(function(){"use strict";var t="undefined"!==typeof window&&"undefined"!==typeof window.document?window.document:{},n=e.exports,a=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],a=0,i=n.length,r={};a<i;a++)if(e=n[a],e&&e[1]in t){for(a=0;a<e.length;a++)r[n[0][a]]=e[a];return r}return!1}(),i={change:a.fullscreenchange,error:a.fullscreenerror},r={request:function(e,n){return new Promise(function(i,r){var s=function(){this.off("change",s),i()}.bind(this);this.on("change",s),e=e||t.documentElement;var o=e[a.requestFullscreen](n);o instanceof Promise&&o.then(s).catch(r)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var i=function(){this.off("change",i),e()}.bind(this);this.on("change",i);var r=t[a.exitFullscreen]();r instanceof Promise&&r.then(i).catch(n)}else e()}.bind(this))},toggle:function(e,t){return this.isFullscreen?this.exit():this.request(e,t)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var a=i[e];a&&t.addEventListener(a,n,!1)},off:function(e,n){var a=i[e];a&&t.removeEventListener(a,n,!1)},raw:a};a?(Object.defineProperties(r,{isFullscreen:{get:function(){return Boolean(t[a.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[a.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[a.fullscreenEnabled])}}}),n?e.exports=r:window.screenfull=r):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}})()},bead:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-monitor"},[e._m(0),n("div",{staticClass:"main"},[n("div",{staticClass:"left"}),n("div",{staticClass:"center"},[n("div",{staticClass:"map-main"},e._l(e.mapList,(function(t,a){return n("div",{key:a,staticClass:"map-item",on:{click:function(t){return e.clickChangeMap(a)}}},[e._v(" "+e._s(t.name)+" ")])})),0)]),n("div",{staticClass:"right"})])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"title"},[n("div",[e._v("蓝芯智能工厂AMR调度监控")])])}],r={props:["mapList"],data:function(){return{}},mounted:function(){this.openInterval()},beforeDestroy:function(){this.clearInterval()},methods:{openInterval:function(){console.log("实时获取主监控页数据")},clearInterval:function(){console.log("清除中央数据的定时器")},clickChangeMap:function(e){this.$emit("clickChangeMap",e)}}},s=r,o=(n("561f"),n("cba8")),c=Object(o["a"])(s,a,i,!1,null,"70d3c383",null);t["default"]=c.exports},cadb:function(e,t,n){"use strict";n.d(t,"d",(function(){return o})),n.d(t,"o",(function(){return u})),n.d(t,"c",(function(){return f})),n.d(t,"q",(function(){return d})),n.d(t,"p",(function(){return m})),n.d(t,"i",(function(){return p})),n.d(t,"j",(function(){return v})),n.d(t,"k",(function(){return h})),n.d(t,"a",(function(){return g})),n.d(t,"l",(function(){return b})),n.d(t,"h",(function(){return k})),n.d(t,"n",(function(){return I})),n.d(t,"e",(function(){return y})),n.d(t,"m",(function(){return w})),n.d(t,"f",(function(){return _})),n.d(t,"b",(function(){return x})),n.d(t,"g",(function(){return C}));var a=n("c159"),i=(n("51b3"),n("acc0"),n("0f8a")),r=n("5422"),s=n("caaf"),o=function(e){return e?s(new Date(e)).locale("zh-cn").format("YYYY-MM-DD HH:mm:ss"):""},c=function(){return s().add(-7,"days").format("YYYY-MM-DD HH:mm:ss")},l=function(){return s().format("YYYY-MM-DD HH:mm:ss")},u=function(){return s().startOf("day").format("YYYY-MM-DD HH:mm:ss")},f=function(){return s().endOf("day").format("YYYY-MM-DD HH:mm:ss")},d=function(){return s(s().startOf("day")).add(-1,"days").format("YYYY-MM-DD HH:mm:ss")},m=function(){return s(s().endOf("day")).add(-1,"days").format("YYYY-MM-DD HH:mm:ss")},p=function(){return s().locale("zh-cn").format("YYYYMMDDHHmmss")},v=function(){return s().format("YYYY-MM-DD HH:mm:ss")},h={shortcuts:[{text:"今天",onClick:function(e){var t=new Date,n=new Date;n.setTime((new Date).setHours(0,0,0,0)),e.$emit("pick",[n,t])}},{text:"昨天",onClick:function(e){e.$emit("pick",[d(),m()])}},{text:"最近一周",onClick:function(e){e.$emit("pick",[c(),l()])}},{text:"最近一个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-2592e6),e.$emit("pick",[n,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-7776e6),e.$emit("pick",[n,t])}}]},g={shortcuts:[{text:"今天",onClick:function(e){var t=new Date,n=new Date;n.setTime((new Date).setHours(0,0,0,0)),e.$emit("pick",[n,t])}},{text:"昨天",onClick:function(e){e.$emit("pick",[d(),m()])}},{text:"最近一周",onClick:function(e){e.$emit("pick",[c(),l()])}},{text:"最近半个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-1296e6),e.$emit("pick",[n,t])}}]},b=function(e,t,n,a){var i=Number(e.slice(11,13));i%2===1?i+=1:Number(e.slice(14,16))>0&&(i+=2),i<10&&(i="0"+i),e=e.slice(0,11)+i+":00:00";var r=Number(t.slice(11,13));r%2===1&&(59===Number(t.slice(14,16))&&59===Number(t.slice(17,19))?r+=1:r-=1),r<10&&(r="0"+r),t=t.slice(0,11)+r+":00:00";var o=Math.ceil(s(t).diff(s(e),n,!0)/a);return[o,e,t]},k=function(e,t){var n=s(t).diff(s(e),"hours")/2;return n},I=function(e,t,n,a){return[s(e).add(t*a,n).format("YYYY-MM-DD HH:mm:ss"),s(e).add((t+1)*a,n).format("YYYY-MM-DD HH:mm:ss")]},y=function(e,t,n){var a=s(t).diff(s(e),n);return"hours"===n&&(a=Math.ceil(a/2)),a},w=function(e,t,n,a){e=e.slice(0,15)+"0:00",t=t.slice(0,15)+"0:00";var i=Math.ceil(s(t).diff(s(e),n,!0)/a);return[i,e,t]},_=function(e,t){var n,a;return e=Date.parse(e),t=Date.parse(t),n=t-e,n=Math.abs(n),a=Math.floor(n/864e5),a},x=function(e){if(e&&e.length>0){var t=Object(a["a"])(e,2),n=t[0],s=t[1],o=_(n,s);return!(o>i["e"])||(r["Message"].warning("导出数据只支持7天以内"),!1)}return r["Message"].warning("请先选择时间区间"),!1},C=function(e,t){var n=s(t).diff(s(e),"days"),a=s(t).diff(s(e),"hours")%24,i=s(t).diff(s(e),"minutes")%60,r=s(t).diff(s(e),"seconds")%60;return(n?n+"天":"")+(a?a+"时":"")+i+"分"+r+"秒"}},f175:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"monitor-container large-screen",attrs:{id:"monitor-container"}},[e.isCarousel?n("el-carousel",{ref:"carousel",attrs:{trigger:"click",height:"100vh",interval:1e3*e.carouseTime,autoplay:e.autoplay,arrow:"never"},on:{change:e.changeCarousel}},[n("el-carousel-item",{attrs:{name:"主监控页",label:"主监控页"}},[n("main-monitor",{ref:"mainMonitor",attrs:{mapList:e.mapList},on:{clickChangeMap:e.clickChangeMap}})],1),e._l(e.mapList,(function(e,t){return n("el-carousel-item",{key:t,attrs:{name:"map-"+e.id,label:e.name}},[n("div",{staticClass:"map-view",attrs:{id:"map-"+e.id}})])}))],2):n("div",[n("div",{attrs:{id:"map-view"}}),n("div",{staticClass:"ui-layer map-layer"},[n("el-select",{staticStyle:{width:"250px","margin-right":"10px",color:"#ccc"},attrs:{"popper-append-to-body":!1,placeholder:"地图名",size:"small"},on:{change:e.changeMap},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},e._l(e.areaLists,(function(t,a){return n("el-option-group",{key:"area"+t.id},[n("div",{staticClass:"workSpace-main"},[n("span",{staticClass:"workSpaceNumber"},[e._v(e._s(a+1))]),n("span",{staticClass:"workSpaceSelect"},[n("span",[e._v(e._s(t.name))])])]),e._l(t["topologyMapPos"],(function(t){return n("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[n("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[n("span",[e._v(e._s(t.name))]),e.unLoginLargeScreen?e._e():n("el-link",{attrs:{underline:!0,type:"primary"},on:{click:function(n){return n.stopPropagation(),e.$router.push({path:"/mapDetails/"+t.id,query:{backPage:e.$route.fullPath}})}}},[e._v("详情 ")])],1)])}))],2)})),1),n("div",[n("el-button",{attrs:{icon:"el-icon-s-tools",size:"small",type:"primary"},on:{click:function(t){e.layersVisible=!e.layersVisible}}}),e.layersVisible?e._l(["路线","点位名称","激光图","AMR标签","任务路径"],(function(t,a){return n("el-button",{key:a,staticClass:"layer-btn",class:{"layer-btn-active":e.activeArr.includes(a)},attrs:{size:"small"},on:{click:function(t){return e.setLayer(a)}}},[e._v(e._s(t)+" ")])})):e._e(),n("el-button",{attrs:{icon:"el-icon-map-location",size:"small",type:"info"},on:{click:function(t){e.locateVisible=!e.locateVisible}}}),e.locateVisible?[n("el-button",{staticClass:"locate-btn",attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.getLocate()}}},[e._v("已存视角")]),n("el-button",{staticClass:"locate-btn",attrs:{size:"small",type:"info",plain:""},on:{click:function(t){return e.getDefaultLocate()}}},[e._v("默认视角")]),n("el-button",{staticClass:"locate-btn",attrs:{size:"small",type:"success",plain:""},on:{click:function(t){return e.saveLocate()}}},[e._v("保存")])]:e._e()],2)],1)]),n("vue-drag-resize",{directives:[{name:"show",rawName:"v-show",value:e.topVisible,expression:"topVisible"}],attrs:{w:215,h:250,isDraggable:!0,isResizable:!1,x:400,y:100,z:1001}},[n("div",{staticClass:"ui-layer top-layer"},[e._l(e.prop,(function(t,a){return n("div",{directives:[{name:"show",rawName:"v-show",value:e.prop.length>0,expression:"prop.length > 0"}],key:a,staticClass:"top-item"},[1===a?n("div",{staticStyle:{margin:"15px 0",height:"2px",background:"-webkit-linear-gradient("}}):n("p",[n("span",{staticClass:"top-item-label"},[e._v(e._s(t.label))]),n("span",[e._v(e._s(t.value))])])])})),n("div",{staticClass:"border-top"}),n("div",{staticClass:"border-close"},[n("i",{staticClass:"el-icon-close",on:{click:function(t){e.topVisible=!1}}})]),n("div",{staticClass:"border-bottom"})],2)]),e.info?n("vue-drag-resize",{attrs:{h:300,isDraggable:!0,isResizable:!1,w:400,x:50,y:400,z:1001,dragCancel:"button,button>span,.el-icon-close,.info-box-btn"}},[n("div",{staticClass:"ui-layer info-layer"},[n("div",{staticClass:"info-title"},[n("span",{staticStyle:{color:"#0075d9","font-size":"16px"}},[e._v("ID")]),n("span",{staticStyle:{color:"#0075d9"}},[e._v(e._s(e.info["id"]))]),n("span",{staticStyle:{color:"#0075d9","font-size":"16px"}},[e._v("IP")]),n("el-button",{staticStyle:{color:"#0075d9","margin-right":"5px","text-decoration":"underline"},attrs:{type:"text"},on:{click:function(t){return e.toAgvWeb(e.info["ip"])}}},[e._v(e._s(e.info["ip"]))]),e.unLoginLargeScreen?e._e():n("el-button",{staticStyle:{"margin-left":"0px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.$router.push({path:"/task/list",query:{mapId:e.value,vehicleId:e.info["id"],backPage:e.$route.fullPath}})}}},[e._v("新增任务 ")]),n("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.releaseLockedPoints(e.info)}}},[e._v("释放点位")])],1),n("div",{staticClass:"info-btn"},[n("span",{staticClass:"info-box-btn",class:{"active-box":0===e.infoState},on:{click:function(t){e.infoState=0}}},[e._v("基本信息")]),n("span",{staticClass:"info-box-btn",class:{"active-box":1===e.infoState},on:{click:function(t){e.infoState=1}}},[e._v("任务信息")]),n("span",{staticClass:"info-box-btn",class:{"active-box":2===e.infoState},on:{click:function(t){e.infoState=2}}},[e._v("任务进度")])]),0===e.infoState?n("div",[n("div",{staticClass:"info-item"},[n("div",{staticClass:"item-title"},[e._v("电量")]),n("div",{staticClass:"item-content"},[n("span",{staticClass:"battery",class:{"battery-low":e.info["batteryPercentile"]<30}},[n("span",{staticClass:"battery-size",style:{height:Math.min(84,e.info["batteryPercentile"])+"%",backgroundColor:e.info["batteryPercentile"]<30?"#fc2201":"#38ffae"}})]),n("span",[e._v(e._s(e.info["batteryPercentile"])+"%")])]),n("div",{staticClass:"item-title"},[e._v("状态")]),n("div",{staticClass:"item-content item-lines"},[9!==e.info["stateId"]?n("el-button",{style:{backgroundColor:[6,8].includes(e.info["stateId"])?"#fc2201":"#4987ff",borderColor:"transparent",cursor:"text"},attrs:{size:"mini",type:"danger"}},[e._v(" "+e._s(e.info["state"])+" ")]):e._e(),2===e.info["stateId"]?n("i",{staticClass:"\n                el-icon-video-pause\n                state-icon state-icon-pause\n                item-lines-buttom\n              ",on:{click:function(t){return e.pauseAmr(e.info)}}}):e._e(),6===e.info["stateId"]?n("i",{staticClass:"\n                el-icon-video-play\n                state-icon state-icon-resume\n                item-lines-buttom\n              ",on:{click:function(t){return e.resumeAmr(e.info)}}}):e._e(),9===e.info["stateId"]?n("el-button",{attrs:{type:"danger"},on:{click:function(t){return t.stopPropagation(),e.toAgvWeb(e.info["ip"])}}},[e._v("等待确认")]):e._e()],1)]),n("div",{staticClass:"info-item"},[n("div",{staticClass:"item-title"},[e._v("位置")]),n("div",{staticClass:"item-content item-lines"},[n("div",[e._v(" "+e._s(e.info["coordinate"]["x"])+", "+e._s(e.info["coordinate"]["y"])+" ")]),e.info.coordinate&&e.info.coordinate.location?n("div",{staticClass:"item-content-oneLine item-lines-buttom"},[n("el-tooltip",{attrs:{effect:"dark",content:e.info["coordinate"]["location"],placement:"top"}},[n("span",[e._v(e._s(e.info["coordinate"]["location"]))])])],1):e._e()]),n("div",{staticClass:"item-title"},[e._v("速度")]),n("div",{staticClass:"item-content"},[e._v(" "+e._s(e.info.velocity&&void 0!==e.info.velocity.vx?e.info.velocity.vx.toFixed(2)+"m/s":"---")+" ")])])]):e._e(),1===e.infoState&&e.amrTaskInfo.id?n("div",[n("el-card",{staticClass:"orderInfo"},[n("div",{staticClass:"orderInfo-header",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("当前任务")]),e.unLoginLargeScreen?e._e():n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.$router.push({path:"/task/list",query:{backPage:e.$route.fullPath,taskChainId:e.amrTaskInfo.id}})}}},[e._v("查看更多")])],1),n("div",{staticClass:"orderInfo-item"},[n("div",{staticClass:"orderInfo-item-title"},[e._v("任务编号:")]),n("div",{staticClass:"orderInfo-item-value"},[e._v(" "+e._s(e.amrTaskInfo.id||"---")+" ")])]),n("div",{staticClass:"orderInfo-item"},[n("div",{staticClass:"orderInfo-item-title"},[e._v("任务名称:")]),n("el-tooltip",{attrs:{effect:"dark",content:e.amrTaskInfo.name,placement:"top"}},[n("div",{staticClass:"orderInfo-item-value"},[e._v(" "+e._s(e.amrTaskInfo.name||"---")+" ")])])],1),n("div",{staticClass:"orderInfo-item"},[n("div",{staticClass:"orderInfo-item-title"},[e._v("目标点位:")]),n("el-tooltip",{attrs:{effect:"dark",content:e.amrTaskInfo.targetPoint,placement:"top"}},[n("div",{staticClass:"orderInfo-item-value"},[e._v(" "+e._s(e.amrTaskInfo.targetPoint||"---")+" ")])])],1),n("div",{staticClass:"orderInfo-item"},[n("div",{staticClass:"orderInfo-item-title"},[e._v("优先级:")]),n("div",{staticClass:"orderInfo-item-value"},[e._v(" "+e._s(void 0===e.amrTaskInfo.priority?"---":e.amrTaskInfo.priority>0?"高":0===e.amrTaskInfo.priority?"正常":"低")+" ")])]),n("div",{staticClass:"orderInfo-item"},[n("div",{staticClass:"orderInfo-item-title"},[e._v("任务状态:")]),n("div",{staticClass:"orderInfo-item-value"},[e._v(" "+e._s(e.taskStateList[e.amrTaskInfo.status]||"---")+" ")])])])],1):e._e(),1!==e.infoState||e.amrTaskInfo.id?e._e():n("div",[n("el-card",{staticClass:"orderInfo empty-main"},[e._v(" 未执行过任务, 点击右上角手动新建任务试试。 ")])],1),2===e.infoState&&e.amrTaskInfo.id?n("div",[n("div",{staticClass:"orderProgress"},[n("div",{staticClass:"orderProgress-item"},[e._v(" 任务ID: "),n("span",{staticClass:"orderProgress-id"},[e._v(e._s(e.amrTaskInfo.id||"---"))])]),4!==e.amrTaskInfo.status?n("div",{staticClass:"orderProgress-item"},[n("el-progress",{attrs:{percentage:e.amrTaskInfo.process||0}})],1):e._e(),4===e.amrTaskInfo.status?n("div",{staticClass:"orderProgress-item"},[n("el-progress",{attrs:{percentage:100,color:"#F56C6C",format:function(){return"异常中"}}})],1):e._e(),e.amrTaskInfo.taskList?n("div",{staticClass:"orderProgress-item orderProgress-steps"},[e.amrTaskInfo.intervalTime&&e.amrTaskInfo.remainTime&&4!==e.amrTaskInfo.status?n("div",{staticClass:"orderProgress-time"},[e._v(" 已执行"+e._s(e.amrTaskInfo.intervalTime)+", 大约剩余"+e._s(e.amrTaskInfo.remainTime)+" ")]):e._e(),n("el-steps",{attrs:{active:e.amrTaskInfo.active||0,"finish-status":"success",direction:e.amrTaskInfo.taskList.length<4?"horizontal":"vertical"}},e._l(e.amrTaskInfo.taskList,(function(e,t){return n("el-step",{key:t,attrs:{title:e.name,description:e.time}})})),1)],1):e._e()])]):e._e(),2!==e.infoState||e.amrTaskInfo.id?e._e():n("div",[n("el-card",{staticClass:"orderInfo empty-main"},[e._v(" 无实时任务, 进度为空。 ")])],1),n("div",{staticClass:"border-top"}),n("div",{staticClass:"border-close"},[n("i",{staticClass:"el-icon-close",on:{click:function(t){return e.changeActiveInfoId(0)}}})]),n("div",{staticClass:"border-bottom"})])]):e._e(),e.isCarousel&&0===e.carouselIndex?e._e():n("agv-layer",{ref:"agvLayer",attrs:{amrList:e.amrList,isPc:e.isPc},on:{changeActiveInfoId:e.changeActiveInfoId}}),n("div",{staticClass:"tool-container"},[n("el-menu",{attrs:{"background-color":"#001844","text-color":"#fff","active-text-color":"teal"}},[e.unLoginLargeScreen?e._e():n("el-tooltip",{attrs:{content:"退出大屏展示",placement:"right",enterable:!1}},[n("el-menu-item",{attrs:{index:"0"},on:{click:function(t){return e.handleVehicleOp("largeScreen")}}},[n("i",{staticClass:"el-icon-circle-close"})])],1),n("el-tooltip",{attrs:{content:e.isFullScreen?"取消全屏":"开启全屏",placement:"right",enterable:!1}},[n("el-menu-item",{attrs:{index:"2"},on:{click:function(t){return e.handleVehicleOp("fullScreen")}}},[n("i",{class:e.isFullScreen?"el-icon-close":"el-icon-full-screen"})])],1)],1)],1),n("div",{staticClass:"nowTime"},[e._v(e._s(e.nowTime))])],1)},i=[],r=n("c159"),s=n("febe"),o=(n("e186"),n("51b3"),n("89a8"),n("1a91"),n("10dd"),n("a536"),n("c93c"),n("4c1e"),n("fee8"),n("8ea3"),n("2788"),n("aa08"),n("0560"),n("87d5"),n("5a05"),n("7c98")),c=n("7cf8"),l=n("25fe"),u=n("7661"),f=n("4f6d"),d=n("00db"),m=n("0115"),p=n("5422"),v=n("e04f"),h=n.n(v),g=n("cadb"),b=n("4360"),k=n("0f8a"),I=n("bd3e"),y=n.n(I),w=n("1b70"),_=n("fbb2"),x=n("5f21"),C=n("22a1"),T=n("bead"),M=n("5f87"),L=(n("5771"),n("21ac")),S=20,O={},A=null,P={props:["innerHeight"],components:{AgvLayer:C["default"],MainMonitor:T["default"]},data:function(){return{timer:0,timerTime:1200,taskTimer:0,taskTime:3e3,layersVisible:!1,activeArr:[0,2,3,4],nodesMapper:{},routesMapper:{},opt:null,prop:[],topVisible:!1,amrList:[],infoState:0,info:null,amrTaskInfo:{},activeInfoId:0,searchVal:"",areaLists:[],mapList:[],value:Number(h.a.get("map__value"))||0,nowTimeTimer:0,nowTime:"",externalTypeEnum:{},taskStateList:k["i"],actionList:{},isFullScreen:document.fullscreenElement,animateTime:50,params:"",loadingMessage:null,timeout:null,unLoginLargeScreen:!Object(M["b"])(),locateVisible:!1,initTimer:null,doingStatusList:[0,1],shouldConcatOldAmr:!1,specialAreaId:0,carouselIndex:0,carouseTime:8,readyDrawTime:4,readyDrawTimer:0,isCarousel:!1,autoplay:!1,isClearDraw:!1,clearDrawNum:6,changeCarouselTimer:0,notificationMap:new L["a"],isPc:window.globalConfig.isPc}},beforeDestroy:function(){for(var e in this.changeCarouselTimer&&clearTimeout(this.changeCarouselTimer),this.readyDrawTimer&&clearTimeout(this.readyDrawTimer),this.initTimer&&clearInterval(this.initTimer),this.initTimer=null,this.loadingMessage&&this.loadingMessage.close(),this.timer&&clearInterval(this.timer),this.timer=null,this.taskTimer&&clearInterval(this.taskTimer),O){var t=O[e];t&&t.destroyed(),t=null}O={},this.nowTimeTimer&&clearInterval(this.nowTimeTimer),this.timeout&&clearTimeout(this.timeout),window.removeEventListener("resize",this.onResize),A=null,p["Notification"].closeAll(),this.notificationMap.dangerNotificationList=null},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.shouldConcatOldAmr=b["a"].getters.permissions.indexOf("monitor/showOldAmr")>-1,e.unLoginLargeScreen&&(n=e.$route.query.areaId,e.specialAreaId=Object(x["a"])(n)),e.initTimer=setInterval(Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.initTimer){t.next=10;break}if(!window.BIGMapMonitor){t.next=9;break}return e.initTimer&&clearInterval(e.initTimer),e.initTimer=null,t.next=6,e.getAreaMonitor();case 6:e.isCarousel?(window.addEventListener("resize",e.onResize),e.activeArr.push(1),e.preDrawMonitor(0)):e.$nextTick(Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.changeMap();case 2:window.addEventListener("resize",e.onResize),e.activeArr.push(1),e.setLayer(-1);case 5:case"end":return t.stop()}}),t)})))),t.next=10;break;case 9:A||(A=document.getElementsByTagName("head")[0],n=document.createElement("script"),n.type="text/javascript",n.src="bigMap.monitor.js?v=1.14_20220402",A.appendChild(n));case 10:case"end":return t.stop()}}),t)}))),50),Object(f["e"])().then((function(t){t.state&&t.data&&t.data.forEach((function(t){e.$set(e.actionList,t.action,t.name)}))})),e.nowTimeTimer&&clearInterval(e.nowTimeTimer),e.nowTimeTimer=setInterval((function(){e.nowTime=Object(g["j"])()}),1e3);case 6:case"end":return t.stop()}}),t)})))()},methods:{onResize:function(){this.resetMapSize(this.value);var e=O[this.setMapId()];e&&e.onWindowResize(),this.isFullScreen=document.fullscreenElement},getAreaMonitor:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["b"])().then((function(t){if(t.state&&t.data){e.areaLists=[];var n=[],a={};t.data.forEach((function(t){e.unLoginLargeScreen&&e.specialAreaId!==t["areaPo"].id||(t["areaPo"]["topologyMapPos"]=t["topologyMapPos"],t["topologyMapPos"].forEach(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a[t.id]=!0,n.push(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t["topologyMapPos"].length>0&&e.areaLists.push(t["areaPo"]))})),e.value&&a[e.value]||(n[0]?e.value=n[0].id:e.value=0),n.sort((function(e,t){return e.name.localeCompare(t.name)})),e.mapList=n,e.isClearDraw=n.length>e.clearDrawNum}}));case 2:case"end":return t.stop()}}),t)})))()},changeMap:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.topVisible=!1,e.onResize(),t.next=4,e.getMapData();case 4:e.getOnlineAmr(),e.timer&&clearInterval(e.timer),e.timer=setInterval((function(){e.timer&&e.getOnlineAmr()}),e.timerTime);case 7:case"end":return t.stop()}}),t)})))()},getMapData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a,i,o,c,f,v,g,b,I,y,_,x,C,T;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(p["Notification"].closeAll(),t.notificationMap.dangerNotificationList={},a=e||t.value,console.log("当前地图: "+a),a){n.next=6;break}return n.abrupt("return");case 6:if(i=O[t.setMapId(a)],t.loadingMessage&&t.loadingMessage.close(),e||t.isCarousel&&(!t.isCarousel||i)||(t.loadingMessage=Object(p["Message"])({type:"info",duration:2e5,message:"正在绘制地图中, 请稍后"})),o=document.getElementById(t.setMapId(a)),o){n.next=12;break}return n.abrupt("return",p["Message"].error("容器错误, 绘制地图失败"));case 12:return i||(i=new window.BIGMapMonitor(o,t.animateTime),O[t.setMapId(a)]=i,window.BIGMapMonitor.instance=O[t.setMapId(t.value)],i.clickObjCallback=function(e){t.changeActiveInfoId(e,!0)},i.clickNodeCallback=function(e){if(t.nodesMapper[t.value]){var n=t.nodesMapper[t.value][e];t.topVisible=!0,t.prop=[],[["id","点位ID"],[],["alias","别名"],["code","编码"],["allowPark","停靠"],["theta","角度"],["typeName","类型"],["x","坐标 x"],["y","坐标 y"]].forEach((function(e){t.prop.push({label:e[1],value:n[e[0]]})}))}},i.clickRouteCallback=function(e){if(t.routesMapper[t.value]){var n=t.routesMapper[t.value][e];t.topVisible=!0,t.prop=[],[["id","路径ID"],[],["source","起始点"],["target","结束点"],["maxSpeed","最大速度"]].forEach((function(e){t.prop.push({label:e[1],value:n[e[0]]})}))}}),n.next=15,Object(u["b"])({mapId:a}).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(n){var r,s,o,c,l,u,f,d,m,p,v,g;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n.state&&n.data&&(!t.unLoginLargeScreen||n.data.topologyMap.areaId===t.specialAreaId)){e.next=4;break}return t.value="",t.loadingMessage&&t.loadingMessage.close(),e.abrupt("return");case 4:return h.a.set("map__value",t.value),r=n.data,s=r.Edge,o=r.Vertex,c=r.area,t.animateTime=50,o.length>1e3&&(t.animateTime+=25*Math.floor(o.length/1e3),t.animateTime>100&&(t.animateTime=100)),l=n.data["topologyMap"],u=l.backgroundImgUrl,f=l.height,d=l.weight,m=l.originX,p=l.originY,v=l.name,t.nodesMapper[a]={},t.routesMapper[a]={},o.forEach((function(e){var n=e["vertexPo"];t.nodesMapper[a][n.code]=n})),g=[],s.forEach((function(e){var n=e["edgePo"];t.routesMapper[a][n.id]=n;var i=t.nodesMapper[a][n["source"]],r=t.nodesMapper[a][n["target"]];i&&r?g.push({id:n.id,startCode:n["source"],endCode:n["target"],startPos:[i["x"]*S,0,-i["y"]*S],endPos:[r["x"]*S,0,-r["y"]*S],property3:Number(n.turningMode)}):console.log(e)})),t.opt={floor:u,width:d*S,height:f*S,minX:m*S,minY:p*S,nodes:[],routes:g,baseMapName:v},i.createScene(t.opt),e.abrupt("return",{area:c,Vertex:o});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 15:if(c=n.sent,!c||!c.area){n.next=21;break}f=c.area,v=c.Vertex,n.next=22;break;case 21:return n.abrupt("return");case 22:if(0!==Object.keys(t.externalTypeEnum).length){n.next=25;break}return n.next=25,Object(d["d"])().then((function(e){e&&e.state&&e.data.forEach((function(e){t.$set(t.externalTypeEnum,e.id,e.name)}))}));case 25:return g={},n.next=28,Object(d["c"])({mapIds:[a]});case 28:return b=n.sent,b&&b.state&&b.data&&b.data.data.forEach((function(e){var t=e.vertexCodes||e.vertexCode;t=t.split(","),t.forEach((function(t){g[t]=e}))})),I=[],y={},v.forEach((function(e){var n=e["vertexPo"],a=g[n.code];a?(n.externalType=a.typeId,n.typeName=t.externalTypeEnum[a.typeId]):n.typeName=k["a"][n.type],y[n.id]=n,I.push({node:n.code,alias:n.alias,x:n.x*S,y:-n.y*S,type:Number(n.type),externalType:n.externalType,id:n.id})})),_=[],n.next=36,Object(l["a"])({areaId:f.id});case 36:return x=n.sent,x&&x.state&&x.data&&x.data.blocks&&x.data.blocks.forEach((function(e){var t=e.ids,n=[];t.forEach((function(e){var t=Object(r["a"])(e,2),i=t[0],s=t[1];if(i===a){var o=y[s];o&&n.push([o["x"]*S,-o["y"]*S])}})),n.length>1&&_.push(n)})),_=_.map((function(e){return Object(w["a"])(e)})),C=[],n.next=42,Object(m["f"])({mapId:a});case 42:T=n.sent,T&&T.state&&T.data.data&&T.data.data.forEach((function(e){if(e.enable){var t=y[e.vertexId];t&&C.push([t["x"]*S,-t["y"]*S])}})),i.createOthers({nodes:I,blocks:_,chargePiles:C}),e||(t.changeActiveInfoId(0),i.rafId&&clearInterval(i.rafId),i.rafId=setInterval((function(){i&&i.animate()}),t.animateTime),t.getLocate(!0)),t.timeout=setTimeout((function(){t.loadingMessage&&t.loadingMessage.close()}),500);case 47:case"end":return n.stop()}}),n)})))()},setLayer:function(e,t){var n=this,a=t||this.value,i=O[this.setMapId(a)];this.activeArr.includes(e)?this.activeArr=o["without"](this.activeArr,e):this.activeArr.push(e),!t&&1===e&&this.activeArr.includes(e)&&Object.keys(this.nodesMapper[a]).length>0&&0===i.nodeIconsGroup.children.length&&(this.loadingMessage&&this.loadingMessage.close(),this.loadingMessage=Object(p["Message"])({type:"info",duration:1e4,message:"正在绘制点位名称中, 请稍后"})),this.timeout&&clearTimeout(this.timeout),setTimeout((function(){i&&(i.setLayers({routesVisible:n.activeArr.includes(0),nodesVisible:n.activeArr.includes(1),laserVisible:n.activeArr.includes(2),objLabelVisible:n.activeArr.includes(3),pathVisible:n.activeArr.includes(4)}),n.timeout=setTimeout((function(){n.loadingMessage&&n.loadingMessage.close()}),500))}),50)},getOnlineAmr:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=O[e.setMapId()],e.value&&n){t.next=3;break}return t.abrupt("return");case 3:if(a=[],!e.shouldConcatOldAmr){t.next=9;break}return t.next=7,Object(c["c"])();case 7:i=t.sent,a=Object(x["c"])(i);case 9:return t.next=11,Object(c["d"])({mapId:e.value}).then((function(t){var i=e.$refs.agvLayer.isSortAmr;if(e.amrList=Object(x["d"])(t.data,a,i),e.info=e.amrList.find((function(t){return Number(t["id"])===e.activeInfoId}))||null,e.info||e.changeActiveInfoId(0),e.amrList.length<1&&n.clearAniObjs){n.clearAniObjs();var r=JSON.stringify([]),s=!1;return e.params!==r&&(e.params=r,s=!0),void(s&&n.enableRender())}var o=[];e.amrList.forEach((function(t){t=JSON.parse(JSON.stringify(t));var n=[],a=[],i="";t["unFinishRoute"]&&t["unFinishRoute"]["unfinishedVertexes"]&&t["unFinishRoute"]["unfinishedVertexes"].length>0&&e.nodesMapper[e.value]&&(n=t["unFinishRoute"]["unfinishedVertexes"].map((function(t){var n=t.x,a=t.y,r=t.code,s=e.nodesMapper[e.value][r];return s?(i=r,[s.x*S,2,-s.y*S]):[n*S,2,-a*S]}))),t.lockedPoint&&e.nodesMapper[e.value]&&t.lockedPoint.forEach((function(n){var i=e.nodesMapper[e.value][n]||t["unFinishRoute"]&&t["unFinishRoute"]["unfinishedVertexes"]&&t["unFinishRoute"]["unfinishedVertexes"].filter((function(e){return e.code===n}))[0];if(i){var r=i.x,s=i.y;a.push([r*S,-s*S])}}));var r=!1;t.loadStatus&&"EMPTY"!==t.loadStatus&&(r=!0);var s=e.activeInfoId===Number(t["id"]);o.push({code:t["name"],id:Number(t["id"]),x:t["coordinate"]["x"]*S,y:2,z:-t["coordinate"]["y"]*S,angle:t["coordinate"]["theta"],type:t["stateId"]||0,state:t["state"],warnId:t["warnId"],path:s?n:[],occupiedNodes:s?a:null,isLoad:r,targetPoint:i,batteryPercentile:t["batteryPercentile"],times:e.timerTime})}));var c=JSON.stringify(o),l=!1;e.params!==c&&(e.params=c,l=!0),n.update(o,l),e.isPc&&e.notificationMap.getDangerList(e.amrList)}));case 11:case"end":return t.stop()}}),t)})))()},resetMapSize:function(e){var t=document.getElementById(this.setMapId(e));if(t){var n=document.getElementById("monitor-container"),a=n.getBoundingClientRect(),i=a.width,r=window.innerHeight,s=window.getComputedStyle(n,"padding"),o=s.paddingTop,c=s.paddingRight,l=s.paddingBottom,u=s.paddingLeft,f=u.split("px")[0],d=c.split("px")[0],m=o.split("px")[0],p=l.split("px")[0],v=i-f-d+"px",h=r-m-p+"px";t.style.width=v,t.style.height=h,t.children[0]&&(t.children[0].style.width=v,t.children[0].style.height=h)}},pauseAmr:function(e){p["MessageBox"].confirm("确定暂停小车: ".concat(e.name,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["g"])({id:e.id}).then((function(e){e.state&&p["Message"].success("小车暂停成功")}))})).catch((function(){}))},resumeAmr:function(e){p["MessageBox"].confirm("确定恢复小车: ".concat(e.name,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(c["h"])({id:e.id}).then((function(e){e.state&&p["Message"].success("小车恢复成功")}))})).catch((function(){}))},getAmrTaskInfo:function(){var e=this;Object(c["a"])({id:this.activeInfoId}).then((function(t){if(e.amrTaskInfo={},t.state&&t.data){var n=t.data,a=n.taskChain,i=n.tasks;if(a&&(e.$set(e.amrTaskInfo,"id",a.id),e.$set(e.amrTaskInfo,"name",a.name),e.$set(e.amrTaskInfo,"priority",a.priority),e.$set(e.amrTaskInfo,"status",a.status)),i){var r=[],s=0,c="";i.forEach((function(t,n){var a=t.action,i=t.startTime,o=t.status,l=t.endPointCode,u={name:e.actionList[a],time:i?Object(g["d"])(i)+"":""};r.push(u),-1===e.doingStatusList.indexOf(o)?s=++n:c||(c=l)})),e.$set(e.amrTaskInfo,"taskList",r),e.$set(e.amrTaskInfo,"active",s),e.$set(e.amrTaskInfo,"targetPoint",c);var l=Object(g["g"])(a.startTime,new Date);e.$set(e.amrTaskInfo,"intervalTime",l);var u=e.info&&e.info.unFinishRoute?o["round"](100*e.info.unFinishRoute.processRate,1):0;e.$set(e.amrTaskInfo,"process",u);var f="";if(u){var d=new Date(a.startTime).getTime()+((new Date).getTime()-new Date(a.startTime).getTime())/u*100;f=Object(g["g"])(new Date,d)}e.$set(e.amrTaskInfo,"remainTime",f)}}}))},releaseLockedPoints:function(e){p["MessageBox"].confirm("确定释放以下小车占用点位: ".concat(e.name,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(_["k"])({amrId:e.id}).then((function(e){e.state&&p["Message"].success("小车占用点位释放成功")}))})).catch((function(){}))},toAgvWeb:function(e){window.open("http://"+e+":9998")},handleVehicleOp:function(e){switch(e){case"largeScreen":this.isFullScreen&&this.handleVehicleOp("fullScreen"),this.$router.push("/monitor/index");break;case"fullScreen":y.a.isEnabled?y.a.toggle():p["Message"].warning("您的浏览器不支持全屏");break}},getLocate:function(e){var t=O[this.setMapId()];if(t){var n=localStorage.getItem("mapLocate"+this.value);if(n){var a=JSON.parse(n),i=a.camera,r=a.control;t.setLocate(i,r)}else e||Object(p["Message"])({type:"warning",message:"没有获取到保存的视角",offset:80})}},getDefaultLocate:function(){var e=O[this.setMapId()];e&&e.setLocate()},saveLocate:function(){var e=O[this.setMapId()];if(e){var t=e.camera.position,n=t.x,a=t.y,i=t.z,r=e.control.target,s=r.x,c=r.y,l=r.z,u={camera:{x:o["round"](n,2),y:o["round"](a,2),z:o["round"](i,2)},control:{x:o["round"](s,2),y:o["round"](c,2),z:o["round"](l,2)}};localStorage.setItem("mapLocate"+this.value,JSON.stringify(u)),Object(p["Message"])({type:"success",message:"视角保存成功",offset:80})}},changeActiveInfoId:function(e,t){var n=this,a=O[this.setMapId()];if(this.taskTimer&&clearInterval(this.taskTimer),e<0)return this.activeInfoId=0,this.info=null,void(this.amrTaskInfo={});this.activeInfoId=Number(e),this.activeInfoId?(this.getAmrTaskInfo(),this.taskTimer=setInterval((function(){n.taskTimer&&n.getAmrTaskInfo()}),this.taskTime),!t&&a&&a.clickVehicle&&a.clickVehicle(this.activeInfoId)):(this.info=null,this.amrTaskInfo={})},clickChangeMap:function(e){this.$refs.carousel.setActiveItem(e+1)},changeCarousel:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n.topVisible=!1,n.carouselIndex=e,i=n.mapList[--e],n.value=i?i.id:0,!n.value){a.next=19;break}if(r=O[n.setMapId()],r){a.next=9;break}return a.next=9,n.getMapData();case 9:r=O[n.setMapId()],window.BIGMapMonitor.instance=r,n.setLayer(-1),n.changeCarouselTimer&&clearTimeout(n.changeCarouselTimer),n.changeCarouselTimer=setTimeout((function(){n.onResize(),n.changeActiveInfoId(0),r.rafId&&clearInterval(r.rafId),r.rafId=setInterval((function(){r&&r.animate()}),n.animateTime),n.getLocate(!0)}),500),n.getOnlineAmr(),n.timer&&clearInterval(n.timer),n.timer=setInterval((function(){n.timer&&n.getOnlineAmr()}),n.timerTime),a.next=20;break;case 19:n.$refs.mainMonitor&&n.$refs.mainMonitor.openInterval();case 20:n.clearOldMonitor(--t),n.preDrawMonitor(++e);case 22:case"end":return a.stop()}}),a)})))()},preDrawMonitor:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var a;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=t.mapList[e],t.readyDrawTimer&&clearTimeout(t.readyDrawTimer),a?t.readyDrawTimer=setTimeout(Object(s["a"])(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=a.id,t.resetMapSize(n),i=O[t.setMapId(n)],!i){e.next=6;break}e.next=9;break;case 6:return e.next=8,t.getMapData(n);case 8:t.activeArr.includes(1)&&t.setLayer(-1,n);case 9:case"end":return e.stop()}}),e)}))),1e3*(t.carouseTime-t.readyDrawTime)):console.log("即将进入主监控页");case 3:case"end":return n.stop()}}),n)})))()},clearOldMonitor:function(e){var t=this.mapList[e];if(t){var n=this.setMapId(t.id),a=O[n];switch(this.isClearDraw){case!0:a&&(a.destroyed(),a=null,O[n]=null);var i=document.getElementById(n);i&&(i.innerText="");break;case!1:a&&(a.clearAniObjs(),a.rafId&&clearInterval(a.rafId),a.traceTarget=null,a.intersected=null);break}}else this.$refs.mainMonitor&&this.$refs.mainMonitor.clearInterval()},setMapId:function(e){var t=e||this.value;return this.isCarousel?"map-"+t:"map-view"}}},D=P,F=(n("897e"),n("cba8")),E=Object(F["a"])(D,a,i,!1,null,"f88af942",null);t["default"]=E.exports},fbb2:function(e,t,n){"use strict";n.d(t,"h",(function(){return i})),n.d(t,"j",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"n",(function(){return o})),n.d(t,"l",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return u})),n.d(t,"o",(function(){return f})),n.d(t,"q",(function(){return d})),n.d(t,"r",(function(){return m})),n.d(t,"p",(function(){return p})),n.d(t,"e",(function(){return v})),n.d(t,"i",(function(){return h})),n.d(t,"b",(function(){return g})),n.d(t,"s",(function(){return b})),n.d(t,"d",(function(){return k})),n.d(t,"m",(function(){return I})),n.d(t,"f",(function(){return y})),n.d(t,"k",(function(){return w}));var a=n("b775");function i(e){return a["a"].post("/amr/getAmrPageList",e)}function r(){return a["a"].get("/amr/listAmrType")}function s(e){return a["a"].post("/amr/register",e)}function o(e){return a["a"].post("/amr/editorAmr",e)}function c(e){return a["a"].get("/amr/enable",e)}function l(e){return a["a"].post("/amr/deleteAmr/"+e)}function u(e){return a["a"].get("/amr/getDetailAmr",e)}function f(e){return a["a"].get("/amr/updateArea",e)}function d(e){return a["a"].get("/amr/updateGroup",e)}function m(e){return a["a"].get("chargeConf/update/amrAdaptation",e)}function p(e){return a["a"].get("chargeConf/update/amrBind",e)}function v(e){return a["a"].get("chargeConf/bind/force",e)}function h(e){return a["a"].get("rest/config/find",e)}function g(e){return a["a"].post("rest/config/add",e)}function b(e){return a["a"].post("rest/config/update",e)}function k(e){return a["a"].get("rest/config/delete",e)}function I(e){return a["a"].get("amr/unRegister",e)}function y(e){return a["a"].get("traffic/locked/find",e)}function w(e){return a["a"].get("traffic/locked/release",e)}}}]);
//# sourceMappingURL=chunk-33568ea9.1649302258356.js.map