(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ec028310"],{"0877":function(t,e,a){var i=a("88d4"),n=a("c88c"),r=a("d421");i({target:"Array",proto:!0},{fill:n}),r("fill")},"1a8f":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"connect-container"},[a("div",{ref:"filterContainer",staticClass:"filter-container filter-container-flex"},[a("el-page-header",{staticStyle:{"margin-right":"20px"},attrs:{content:t.areaName},on:{back:t.goBack}}),a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"config/area/update",expression:"'config/area/update'"}],attrs:{type:"success",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("新增连接点")])],1),a("div",{staticClass:"table-container"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],attrs:{data:t.tableList,"highlight-current-row":"",border:"",height:t.innerHeightMinusFilter-141}},[a("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"100",fixed:"left"}}),a("el-table-column",{attrs:{label:"起始地图",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.mapList[e.row.sourceMapId]&&t.mapList[e.row.sourceMapId].name)+" ")]}}])}),a("el-table-column",{attrs:{label:"起始点位",prop:"sourceConnectPoint",align:"center"}}),a("el-table-column",{attrs:{label:"目标地图",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.mapList[e.row.targetMapId]&&t.mapList[e.row.targetMapId].name)+" ")]}}])}),a("el-table-column",{attrs:{label:"目标点位",prop:"targetConnectPoint",align:"center"}}),a("el-table-column",{attrs:{label:"虚拟距离",prop:"virtualDistance",align:"center"}}),a("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.row;return[a("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:"config/area/update",expression:"'config/area/update'"}],attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.handleDelete(i)}}})]}}])})],1)],1),a("el-dialog",{staticClass:"drawMap-container",class:t.fullscreen?"fullscreen-dialog":"",attrs:{visible:t.dialogFormVisible,width:"90%","close-on-click-modal":!1,fullscreen:t.fullscreen,top:"30px"},on:{"update:visible":function(e){t.dialogFormVisible=e},close:t.closeDialog}},[a("div",{staticClass:"dialog-title",attrs:{slot:"title"},slot:"title"},[a("span",[t._v(t._s("create"===t.dialogStatus?"增加连接点":"修改连接点"))]),a("a",{staticStyle:{"margin-right":"30px"},on:{click:t.setFullScreen}},[a("i",{staticClass:"el-icon-full-screen"})])]),a("el-form",{ref:"dataForm",staticClass:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-width":"110px",width:"400px"}},[a("el-form-item",{attrs:{prop:"sourceMapId"}},[a("el-button",{attrs:{slot:"label",size:"small",type:t.temp.sourceMapId&&t.temp.sourceMapId===t.drawMapId?"success":"info",round:""},on:{click:function(e){return t.createMapView(t.temp.sourceMapId)}},slot:"label"},[t._v("起始地图")]),a("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择地图"},on:{change:function(e){return t.createMapView(t.temp.sourceMapId)}},model:{value:t.temp.sourceMapId,callback:function(e){t.$set(t.temp,"sourceMapId","string"===typeof e?e.trim():e)},expression:"temp.sourceMapId"}},t._l(t.mapList,(function(e,i){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:t.temp.areaId===e.areaId&&Number(i)!==t.temp.targetMapId,expression:"\n              temp.areaId === value.areaId && Number(key) !== temp.targetMapId\n            "}],key:i,attrs:{label:e.name,value:Number(i)}})})),1)],1),a("el-form-item",{attrs:{label:"起始点位",prop:"sourceConnectPoint"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择点位"},on:{change:function(e){return t.setPoint(t.temp.sourceConnectPoint)}},model:{value:t.temp.sourceConnectPoint,callback:function(e){t.$set(t.temp,"sourceConnectPoint","string"===typeof e?e.trim():e)},expression:"temp.sourceConnectPoint"}},t._l(t.pointList,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{attrs:{prop:"targetMapId"}},[a("el-button",{attrs:{slot:"label",size:"small",type:t.temp.targetMapId&&t.temp.targetMapId===t.drawMapId?"success":"info",round:""},on:{click:function(e){return t.createMapView(t.temp.targetMapId)}},slot:"label"},[t._v("目标地图")]),a("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择地图"},on:{change:function(e){return t.createMapView(t.temp.targetMapId)}},model:{value:t.temp.targetMapId,callback:function(e){t.$set(t.temp,"targetMapId","string"===typeof e?e.trim():e)},expression:"temp.targetMapId"}},t._l(t.mapList,(function(e,i){return a("el-option",{directives:[{name:"show",rawName:"v-show",value:t.temp.areaId===e.areaId&&Number(i)!==t.temp.sourceMapId,expression:"\n              temp.areaId === value.areaId && Number(key) !== temp.sourceMapId\n            "}],key:i,attrs:{label:e.name,value:Number(i)}})})),1)],1),a("el-form-item",{attrs:{label:"目标点位",prop:"targetConnectPoint"}},[a("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择点位"},on:{change:function(e){return t.setPoint(t.temp.targetConnectPoint)}},model:{value:t.temp.targetConnectPoint,callback:function(e){t.$set(t.temp,"targetConnectPoint","string"===typeof e?e.trim():e)},expression:"temp.targetConnectPoint"}},t._l(t.pointList,(function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),a("el-form-item",{attrs:{label:"虚拟距离",prop:"virtualDistance"}},[a("el-input",{attrs:{placeholder:"请输入虚拟距离",clearable:"",maxlength:30},model:{value:t.temp.virtualDistance,callback:function(e){t.$set(t.temp,"virtualDistance","string"===typeof e?e.trim():e)},expression:"temp.virtualDistance"}})],1)],1),a("el-main",{class:[t.fullscreen?"drawMap-fullscreen":""],attrs:{id:"drawMap"}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{width:"100px"},on:{click:t.closeDialog}},[t._v("取 消")]),a("el-button",{staticStyle:{width:"100px","margin-left":"30px"},attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.registerCharge():t.updateVehicle()}}},[t._v("确 认")])],1)],1)],1)},n=[],r=a("febe"),o=(a("e186"),a("89a8"),a("1a91"),a("51b3"),a("87d5"),a("4c1e"),a("d1ba"),a("2840")),s=a("7661"),c=a("b775");function l(t){return c["a"].get("map/connect/list",t)}function u(t){return c["a"].post("map/connect/add",t)}function p(t){return c["a"].put("map/connect/update",t)}function d(t){return c["a"].get("map/connect/delete",t)}var m=a("4034"),h=a("5422"),f={name:"connect",props:["innerHeightMinusFilter"],data:function(){return{tableList:[],tableLoading:!0,dialogFormVisible:!1,dialogStatus:"",listQuery:{mapId:""},temp:{id:null,areaId:"",sourceMapId:"",sourceConnectPoint:"",targetMapId:"",targetConnectPoint:"",virtualDistance:0},rules:{areaId:[{required:!0,message:"区域不能为空",trigger:"change"}],sourceMapId:[{required:!0,message:"起始地图不能为空",trigger:"change"}],sourceConnectPoint:[{required:!0,message:"起始点位不能为空",trigger:"change"}],targetMapId:[{required:!0,message:"目标地图不能为空",trigger:"change"}],targetConnectPoint:[{required:!0,message:"目标点位不能为空",trigger:"change"}],virtualDistance:[{required:!0,message:"虚拟距离不能为空",trigger:"blur"},{message:"虚拟距离必须为纯数字",pattern:/^[-\d]*$/,trigger:"blur"}]},domainList:{},mapList:{},pointList:[],fullscreen:!1,drawMap:new m["a"],mapInfo:{mapPoints:[],mapRoutes:[]},lastCheckedPoint:"",drawMapId:"",backPage:"",areaId:"",areaName:""}},mounted:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$emit("watchFilterHeight"),Object(o["c"])().then((function(e){e.state&&e.data.data&&e.data.data.forEach((function(e){t.$set(t.domainList,e.id,e)}))})),e.next=4,Object(s["c"])().then((function(e){e.state&&e.data.data&&e.data.data.forEach((function(e){t.$set(t.mapList,e.id,e)}))}));case 4:t.drawMap.setPoint=t.setPoint,t.backPage=t.$route.query.backPage,t.areaName="区域: "+t.$route.query.areaName,t.areaId=Number(t.$route.params.id),t.getList();case 9:case"end":return e.stop()}}),e)})))()},methods:{goBack:function(){this.$router.push(this.backPage)},getList:function(){var t=this,e={areaId:this.areaId};this.tableLoading=!0,l(e).then((function(e){t.tableLoading=!1,e.state&&(t.tableList=e.data||[],t.tableList.forEach((function(e){t.mapList[e.mapId]&&(e.areaId=t.mapList[e.mapId].areaId)})))}))},resetTemp:function(){this.temp={id:null,areaId:"",sourceMapId:"",sourceConnectPoint:"",targetMapId:"",targetConnectPoint:"",virtualDistance:0}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["dataForm"].clearValidate()})),this.temp.areaId=this.areaId,this.connectPoints={}},handleUpdate:function(t){var e=this;this.temp=JSON.parse(JSON.stringify(t)),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["dataForm"].clearValidate(),e.createMapView(e.temp.sourceMapId)}))},closeDialog:function(){var t=this;this.drawMap.clearMap(),this.drawMapId="",this.$nextTick((function(){t.$refs["dataForm"].clearValidate(),t.dialogFormVisible=!1}))},handleDelete:function(t){var e=this;this.$confirm("确定删除该连接点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){d({id:t.id}).then((function(t){t.state&&(e.$message.success("连接点删除成功"),e.getList())}))})).catch((function(){}))},registerCharge:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var a=JSON.parse(JSON.stringify(t.temp));delete a.id,delete a.areaId,u(a).then((function(e){e.state&&(t.$message.success("连接点新增成功！"),t.getList(),t.resetTemp(),t.$nextTick((function(){t.$refs["dataForm"].clearValidate(),t.closeDialog()})))}))}}))},updateVehicle:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var a=JSON.parse(JSON.stringify(t.temp));delete a.areaId,delete a.status,delete a.amrId,delete a.type,p(a).then((function(e){e.state&&(t.$message.success("连接点修改成功！"),t.getList(),t.resetTemp(),t.closeDialog())}))}}))},createMapView:function(t){var e=this;t&&this.drawMapId!==t&&(this.drawMapId=t,this.getMap(t).then((function(){e.drawMapView()})).catch((function(t){h["Message"].error(t)})))},getMap:function(t){var e=this;return new Promise((function(a,i){e.mapInfo={mapPoints:[],mapRoutes:[]},e.pointList=[],Object(s["b"])({mapId:t}).then((function(t){var n=t.state,r=t.data;n&&(r?(e.mapInfo={mapPoints:r.Vertex,mapRoutes:r.Edge},r.Vertex.forEach((function(t){e.pointList.push(t.vertexPo.code)})),a()):i("地图数据为空"))}))}))},drawMapView:function(){if(this.drawMapId){this.drawMap.drawMapView({svg:this.$svg,ele:document.getElementById("drawMap"),mapInfo:this.mapInfo});var t="";this.temp.sourceMapId===this.drawMapId?t=this.temp.sourceConnectPoint:this.temp.targetMapId===this.drawMapId&&(t=this.temp.targetConnectPoint),t&&this.setPoint(t)}},setPoint:function(t){this.removePointClass(),this.addPointClass("ADD"+t),this.temp.vertexCode=t,this.temp.sourceMapId===this.drawMapId?this.temp.sourceConnectPoint=t:this.temp.targetMapId===this.drawMapId&&(this.temp.targetConnectPoint=t)},removePointClass:function(){if(this.lastCheckedPoint){var t=this.$svg.get(this.lastCheckedPoint);t&&t.removeClass("selectedPoint")}},addPointClass:function(t){t=t.replace(/#/gi,"---");var e=this.$svg.get(t);e&&e.addClass("selectedPoint"),this.lastCheckedPoint=t},setFullScreen:function(){var t=this;this.fullscreen=!this.fullscreen,this.$nextTick((function(){t.drawMapView()}))}}},g=f,v=a("cba8"),b=Object(v["a"])(g,i,n,!1,null,null,null);e["default"]=b.exports},2840:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"d",(function(){return s})),a.d(e,"e",(function(){return c}));a("b3d9");var i=a("b775");function n(t){return i["a"].post("/area/list",t)}function r(t){return i["a"].post("/area/update",t)}function o(t){return i["a"].post("/area/delete/"+t)}function s(){return i["a"].get("rest/forcedArea/getRestForcedAreaList")}function c(t){var e=t.areaId,a=t.enable;return i["a"].put("rest/forcedArea/addOrUpdate/".concat(e,"/").concat(a))}},4034:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("ebb4"),n=a("a018"),r=a("e902"),o=(a("8ea3"),a("0877"),a("4c1e"),a("d1ba"),a("5422")),s=function(){function t(){Object(n["a"])(this,t),this.svg=null,this.ele=null,this.mapInfo=null,this.canvas=null,this.mapGroup={line:"",point:"",pointText:""},this.clickTimeout=0,this.clickTimeoutTime=300,this.scale=1,this.maxCodeLimit=1e3,this.isCodeShow=!0}return Object(r["a"])(t,[{key:"drawMapView",value:function(t){var e=this,a=t.svg,i=t.ele,n=t.mapInfo;this.svg=a,this.ele=i,this.mapInfo=n;var r=this.svg.get("drawmap");r&&r.remove();var s,c,l,u,p=this.ele.clientWidth-5,d=this.ele.clientHeight-5;if(n.topologyMap)s=n.topologyMap.originX,c=n.topologyMap.originY,l=n.topologyMap.originX+n.topologyMap.weight,u=n.topologyMap.originY+n.topologyMap.height;else{var m=n.mapPoints.map((function(t){var e=t.vertexPo;return e.x})),h=n.mapPoints.map((function(t){var e=t.vertexPo;return e.y}));0===m.length&&(m=[0]),0===h.length&&(h=[0]),s=Math.min.apply(null,m),c=Math.min.apply(null,h),l=Math.max.apply(null,m),u=Math.max.apply(null,h)}var f=new this.svg.Matrix(1,0,0,-1,.5,.5),g=l-s?l-s:1,v=u-c?u-c:1,b=Math.floor(p/g),M=Math.floor(d/v),w=b<M?b:M;if(this.scale=w,this.canvas=this.svg("drawMap").id("drawmap").size(p,d).viewbox(s,c,g,v).transform(f).panZoom({zoomMin:w/3*2,zoomMax:300*w,zoomFactor:w/5}),this.mapGroup.line=this.canvas.group(),this.mapGroup.pointText=this.canvas.group(),this.mapGroup.point=this.canvas.group(),this.drawMapPoint(w),this.drawMapRoute(w),n.mapPoints.length>this.maxCodeLimit){this.isCodeShow=!1;var I="1. 地图点位数量超过".concat(this.maxCodeLimit,"个时, 首次打开<b>不绘制</b>点位名称, 缩放时<b>清除</b>点位名称;</br>2. <b>双击</b>地图时, 绘制点位名称。");Object(o["Message"])({showClose:!0,message:I,duration:1e4,dangerouslyUseHTMLString:!0})}else this.isCodeShow=!0,this.drawSpotCodes();this.canvas.zoom(this.canvas.zoom()-.24),this.canvas.on("dblclick",(function(){n.mapPoints.length>e.maxCodeLimit&&!e.isCodeShow&&(e.isCodeShow=!0,e.drawSpotCodes())})),this.ele.addEventListener("wheel",this.mouseWheelHandler.bind(this),!1),this.setSort()}},{key:"drawMapPoint",value:function(t){var e,a=this,n=Object(i["a"])(this.mapInfo.mapPoints);try{var r=function(){var i=e.value.vertexPo;switch(o="#0067b8",i.type){case 128:o="#cd6600";break;case 0:o="#0067b8";break;default:o="#47fa65";break}var n=a.canvas.circle(2/t).id("ADD"+i.code.replace(/#/gi,"---")).center(i.x,i.y).fill(o).on("click",(function(){a.setPoint(i.code)}));a.mapGroup.point.add(n)};for(n.s();!(e=n.n()).done;){var o;r()}}catch(s){n.e(s)}finally{n.f()}}},{key:"drawMapRoute",value:function(t){var e,a="",n=Object(i["a"])(this.mapInfo.mapRoutes);try{for(n.s();!(e=n.n()).done;){var r=e.value,o=r.startVertex,s=r.targetVertex;a+="M "+o.vertexPo.x+" "+o.vertexPo.y+" L "+s.vertexPo.x+" "+s.vertexPo.y}}catch(c){n.e(c)}finally{n.f()}this.mapGroup.line.path(a).stroke({width:.4/t,color:"rgb(188, 194, 196)"})}},{key:"drawSpotCodes",value:function(){var t=this,e=function(){var e,a=Object(i["a"])(t.mapInfo.mapPoints);try{for(a.s();!(e=a.n()).done;){var n=e.value.vertexPo;t.mapGroup.pointText.add(t.canvas.plain(n.code).font({size:8/t.scale}).scale(-1/4,1/4,n.x,n.y).rotate(180,n.x,n.y).center(n.x,n.y+9/t.scale))}}catch(r){a.e(r)}finally{a.f()}};this.mapInfo.mapPoints.length>this.maxCodeLimit?(this.loadingMessage&&this.loadingMessage.close(),this.loadingMessage=Object(o["Message"])({type:"info",duration:2e5,message:"正在绘制点位名称中, 请稍后"}),setTimeout((function(){e(),t.loadingMessage&&t.loadingMessage.close()}),50)):e()}},{key:"mouseWheelHandler",value:function(){this.mapInfo&&this.mapInfo.mapPoints.length>this.maxCodeLimit&&this.isCodeShow&&(this.isCodeShow=!1,this.mapGroup.pointText.clear())}},{key:"clearMap",value:function(){this.canvas&&this.canvas.clear(),this.loadingMessage&&this.loadingMessage.close()}},{key:"setSort",value:function(){}},{key:"setPoint",value:function(){}}]),t}()},7661:function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"d",(function(){return r})),a.d(e,"a",(function(){return o})),a.d(e,"b",(function(){return s}));var i=a("b775");function n(t){return i["a"].get("/map/mapList",t)}function r(t){return i["a"].post("/map/updateMap",t)}function o(t){return i["a"].post("/map/delete/"+t)}function s(t){return i["a"].get("/map/getMapDetailById",t)}},a018:function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));a("8fec");function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},c88c:function(t,e,a){"use strict";var i=a("ac3c"),n=a("1c34"),r=a("126a");t.exports=function(t){var e=i(this),a=r(e),o=arguments.length,s=n(o>1?arguments[1]:void 0,a),c=o>2?arguments[2]:void 0,l=void 0===c?a:n(c,a);while(l>s)e[s++]=t;return e}},e902:function(t,e,a){"use strict";function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}a.d(e,"a",(function(){return n}))}}]);
//# sourceMappingURL=chunk-ec028310.1649302258356.js.map